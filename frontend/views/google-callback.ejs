<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Auth Complete</title>
</head>
<body>
    <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
        <div style="border: 3px solid #4285f4; border-top: 3px solid transparent; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto;"></div>
        <p>Completing authentication...</p>
        <style>
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        </style>
    </div>

    <script>
        console.log('Callback page loaded');
        console.log('Window opener:', !!window.opener);

        // Check if this is a popup or full-page redirect
        // Always signal parent and attempt to close; NEVER redirect to dashboard here
        if (window.opener) {
            console.log('âœ… Popup detected - sending message to parent');
            try { window.opener.postMessage({ type: 'GOOGLE_AUTH_SUCCESS' }, window.location.origin); } catch (e) {}
        }

        // Storage fallback so parent can detect success even if opener is missing
        try { localStorage.setItem('GOOGLE_AUTH_SUCCESS', '1'); } catch (e) {}

        // Try to close the popup (multiple techniques for Edge)
        setTimeout(() => {
            console.log('ðŸ”„ Attempting to close popup');
            try { window.focus(); } catch (e) {}
            try { window.close(); } catch (e) {}
            try { window.open('', '_self'); } catch (e) {}
            try { window.close(); } catch (e) {}
            let attempts = 0;
            const interval = setInterval(() => {
                attempts++;
                if (attempts > 10) {
                    clearInterval(interval);
                }
                try { window.focus(); } catch (e) {}
                try { window.open('', '_self'); } catch (e) {}
                try { window.close(); } catch (e) {}
            }, 100);
        }, 200);
    </script>
</body>
</html>
