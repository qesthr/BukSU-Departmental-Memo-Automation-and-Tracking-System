<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Faculty Dashboard | Memofy</title>
    <link rel="stylesheet" href="/css/faculty-dashboard.css">
    <link rel="stylesheet" href="/css/fal-topbar.css">
    <link rel="stylesheet" href="/css/fal-nav.css">
    <link rel="stylesheet" href="/css/calendar.css">
    <link rel="stylesheet" href="/css/custom-calendar.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Google Analytics Tracking -->
    <%- include('google-analytics', { propertyId: typeof gaPropertyId !=='undefined' ? gaPropertyId : null }); %>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="/js/lucide.min.js"></script>
    <script>
        window.currentUser = {
            id: '<%= user._id %>',
            email: '<%= user.email %>',
            role: '<%= user.role %>',
            department: '<%= user.department || "" %>'
        };
        // Set calendar connection status for mini calendar
        window.calendarConnected = <%= (user.calendarAccessToken || user.calendarRefreshToken) ? 'true' : 'false' %>;
    </script>
</head>

<body>
    <div class="dashboard-container">
        <%- include('../components/fal-nav'); %>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <%- include('../components/fal-topbar'); %>

            <div class="content-area">
                <!-- Main Grid -->
                <div class="main-grid">

                    <!-- Hero Header -->
                    <header class="hero-header">
                        <div class="hero-overlay">
                            <div class="hero-texts">
                                <h1>Faculty Dashboard</h1>
                                <p>Welcome back, <%= user.firstName %>!</p>
                            </div>
                            <div class="hero-img-container">
                                <img src="/uploads/hero-header.png" class="hero-img" alt="hero-img">
                            </div>
                        </div>
                    </header>

                    <!-- Dashboard Content -->
                    <div class="dashboard-content">
                        <!-- Stats Cards -->
                        <div class="stats-grid">
                            <div class="stat-card-container">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <svg height="50" width="50" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M20 8.94a1.31 1.31 0 0 0-.06-.27v-.09a1.07 1.07 0 0 0-.19-.28l-6-6a1.07 1.07 0 0 0-.28-.19h-.09L13.06 2H7a3 3 0 0 0-3 3v14a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8.94Zm-6-3.53L16.59 8H14ZM18 19a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h5v5a1 1 0 0 0 1 1h5Z" fill="currentColor" />
                                        </svg>
                                    </div>
                                    <div class="stat-info">
                                        <h3>Received Memos</h3>
                                        <div class="stat-value"><%= totalReceived || 0 %></div>
                                        <div class="stat-change">Total memos received</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Memos Section -->
                    <section class="recent-memos-section">
                        <h2>Recent Memos</h2>
                        <div class="memo-container">
                            <div class="memo-list">
                                <% if ((receivedMemos || []).length === 0) { %>
                                    <div class="memo-item">
                                        <i data-lucide="inbox" class="memo-icon"></i>
                                        <div class="memo-info">
                                            <h4>No memos received yet</h4>
                                            <p>Memos sent to you will appear here</p>
                                        </div>
                                    </div>
                                <% } else { %>
                                    <% (receivedMemos || []).forEach(function(memo){ %>
                                        <div class="memo-item">
                                            <i data-lucide="file-text" class="memo-icon blue"></i>
                                            <div class="memo-info">
                                                <h4><%= memo.subject %></h4>
                                                <p>From: <%= memo.sender ? (memo.sender.firstName + ' ' + (memo.sender.lastName || '')) : 'Unknown' %></p>
                                            </div>
                                            <span class="memo-date"><%= new Date(memo.createdAt).toLocaleDateString() %></span>
                                        </div>
                                    <% }); %>
                                <% } %>
                            </div>
                        </div>
                    </section>

                    <!-- Calendar and Analytics -->
                    <div class="side-grid">
                        <div class="calendar-section">
                            <div class="mini-cal-header" style="margin-bottom: 12px;">
                                <h3 id="dashboardMiniCalMonth" style="margin: 0; font-size: 1rem; color: #1f2937; font-weight: 600;">Calendar</h3>
                                <div class="mini-cal-nav">
                                    <button id="dashboardMiniPrev" class="btn-icon" aria-label="Prev" style="border: 1px solid #e2e8f0; background: #fff; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 14px;">&#8249;</button>
                                    <button id="dashboardMiniNext" class="btn-icon" aria-label="Next" style="border: 1px solid #e2e8f0; background: #fff; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 14px;">&#8250;</button>
                                </div>
                            </div>
                            <div id="dashboardMiniCalendar" class="mini-calendar"></div>
                        </div>

                        <div class="backup-section">
                            <i data-lucide="cloud" class="backup-icon"></i>
                            <div class="backup-info">
                                <h3>System Status</h3>
                                <p>All systems operational</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        lucide.createIcons();
    </script>

    <!-- Date Details Modal for Mini Calendar -->
    <div id="dashboardDateModal" class="custom-modal" style="display: none;">
        <div class="custom-modal-overlay"></div>
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h3 id="dashboardDateModalTitle">Date Details</h3>
                <button class="custom-modal-close" id="dashboardDateModalClose">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div id="dashboardDateModalContent"></div>
            </div>
            <div class="custom-modal-footer">
                <button class="custom-modal-btn custom-modal-btn-secondary" id="dashboardDateModalCancel">Close</button>
                <button class="custom-modal-btn custom-modal-btn-primary" id="dashboardDateModalViewCalendar">View Full Calendar</button>
            </div>
        </div>
    </div>

    <script src="/js/dashboard-mini-calendar.js"></script>
</body>

</html>
