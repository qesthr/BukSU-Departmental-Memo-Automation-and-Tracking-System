<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>My Memos | Memofy</title>
    <link rel="stylesheet" href="/css/faculty-memos.css">
    <link rel="stylesheet" href="/css/log.css">
	<link rel="stylesheet" href="/css/fal-topbar.css">
	<link rel="stylesheet" href="/css/fal-nav.css">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

	<!-- Google Analytics Tracking -->
	<%- include('google-analytics', { propertyId: typeof gaPropertyId !== 'undefined' ? gaPropertyId : null }); %>

	<script src="/js/lucide.min.js"></script>
</head>

<body>
	<div class="dashboard-container">
		<%- include('../components/fal-nav'); %>

		<main class="main-content">
			<%- include('../components/fal-topbar'); %>

            <div class="dashboard-content">
                <div class="log-layout">

                    <!-- Memo List Area -->
                    <section class="memo-list-area" style="flex:1 1 auto;">
                        <div class="memo-container">
                            <div class="memo-list-header">
                                <div class="header-controls">
                                    <div class="checkbox-control" style="display: flex; align-items: center; gap: 8px;">
                                        <div class="select-dropdown-wrapper">
                                            <button id="selectDropdownBtn" class="select-dropdown-btn" type="button">
                                                <i data-lucide="square" class="select-icon"></i>
                                                <i data-lucide="chevron-down" class="dropdown-arrow"></i>
                                            </button>
                                            <div id="selectDropdownMenu" class="select-dropdown-menu">
                                                <button type="button" class="select-dropdown-item" data-action="all">All</button>
                                                <button type="button" class="select-dropdown-item" data-action="none">None</button>
                                                <button type="button" class="select-dropdown-item" data-action="read">Read</button>
                                                <button type="button" class="select-dropdown-item" data-action="unread">Unread</button>
                                                <button type="button" class="select-dropdown-item" data-action="starred">Starred</button>
                                                <button type="button" class="select-dropdown-item" data-action="unstarred">Unstarred</button>
                                            </div>
                                        </div>
                                        <button id="bulkArchiveBtn" class="icon-btn-sm" title="Archive Selected" style="display: none;">
                                            <i data-lucide="archive"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="department-filters">
                                    <div class="department-dropdown-wrapper">
                                        <select id="deptFilterDropdown" class="dept-filter-dropdown">
                                            <option value="all">All Departments</option>
                                        </select>
                                    </div>
                                    <div class="priority-dropdown-wrapper">
                                        <select id="priorityFilterDropdown" class="priority-filter-dropdown">
                                            <option value="all">All Priorities</option>
                                            <option value="urgent">ðŸ”´ Urgent</option>
                                            <option value="high">ðŸŸ  High</option>
                                            <option value="medium">ðŸŸ¡ Medium</option>
                                            <option value="low">ðŸ”µ Low</option>
                                        </select>
                                    </div>
                                    <div class="sort-dropdown-wrapper">
                                        <select id="sortDropdown" class="sort-dropdown">
                                            <option value="newest">Newest</option>
                                            <option value="oldest">Oldest</option>
                                            <option value="priority">Priority</option>
                                            <option value="subject">Subject (A-Z)</option>
                                            <option value="sender">Sender (A-Z)</option>
                                        </select>
                                    </div>
                                    <div class="date-filter-wrapper">
                                        <input type="date" id="dateFilterInput" class="date-filter-input" title="Filter by date">
                                        <button id="clearDateFilter" class="date-filter-clear" title="Clear date filter" style="display: none;">
                                            <i data-lucide="x"></i>
                                        </button>
                                    </div>
                                    <!-- No Compose button for faculty -->
                                </div>
                            </div>

                            <div id="memoList" class="memo-list"></div>
                        </div>
                    </section>

                    <!-- Memo Viewer Modal -->
                    <div id="memoViewerModal" class="modal memo-viewer-modal" style="display: none;">
                        <div class="modal-content memo-viewer-modal-content">
                            <div id="memoViewer" class="memo-viewer">
                                <div class="viewer-header">
                                    <button id="backBtn" class="icon-btn" title="Close">
                                        <i data-lucide="x"></i>
                                    </button>
                                    <div class="nav-buttons">
                                        <button id="prevBtn" class="icon-btn" title="Previous Memo">
                                            <i data-lucide="chevron-left"></i>
                                        </button>
                                        <span id="memoCounter" class="memo-counter">0 of 0</span>
                                        <button id="nextBtn" class="icon-btn" title="Next Memo">
                                            <i data-lucide="chevron-right"></i>
                                        </button>
                                    </div>
                                    <div class="viewer-actions">
                                        <button id="starBtn" class="icon-btn" title="Toggle Favorite">
                                            <i data-lucide="bookmark"></i>
                                        </button>
                                        <button id="acknowledgeBtn" class="icon-btn" title="Acknowledge Memo" style="display: none;">
                                            <i data-lucide="check-circle"></i>
                                        </button>
                                        <button id="archiveBtn" class="icon-btn" title="Archive Memo">
                                            <i data-lucide="archive"></i>
                                        </button>
                                        <button id="downloadBtn" class="icon-btn" title="Download Memo">
                                            <i data-lucide="download"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="memo-content">
                                    <div class="memo-gmail-header">
                                        <h2 id="memoDetailSubject" class="memo-subject-title"></h2>
                                        <div class="memo-sender-header">
                                            <img id="memoSenderAvatar" src="/images/memofy-logo.png" alt="Sender"
                                                class="memo-sender-avatar-img">
                                            <div class="memo-sender-info-header">
                                                <div class="memo-sender-name-header" id="memoDetailFromName"></div>
                                                <div class="memo-sender-email-header" id="memoDetailFromEmail"></div>
                                            </div>
                                        </div>
                                        <div class="memo-to-dropdown-header" id="toDropdownToggle"
                                            style="cursor: pointer; padding: 8px 0; color: #6b7280; font-size: 13px; position: relative;">
                                            <span id="memoDetailToPreview" style="text-decoration: underline;">to me</span>
                                            <i data-lucide="chevron-down" style="width: 16px; height: 16px; margin-left: 4px;"></i>
                                            <div id="memoDetailsPopup" class="memo-details-popup" style="display: none;">
                                                <div class="memo-details-popup-content">
                                                    <div class="memo-detail-popup-row">
                                                        <span class="memo-detail-popup-label">Subject:</span>
                                                        <span id="memoDetailSubjectPopup" class="memo-detail-popup-value"></span>
                                                    </div>
                                                    <div class="memo-detail-popup-row">
                                                        <span class="memo-detail-popup-label">From:</span>
                                                        <span id="memoDetailFromPopup" class="memo-detail-popup-value"></span>
                                                    </div>
                                                    <div class="memo-detail-popup-row">
                                                        <span class="memo-detail-popup-label">To:</span>
                                                        <span id="memoDetailToPopup" class="memo-detail-popup-value"></span>
                                                    </div>
                                                    <div class="memo-detail-popup-row">
                                                        <span class="memo-detail-popup-label">Department:</span>
                                                        <span id="memoDetailDepartmentPopup" class="memo-detail-popup-value"></span>
                                                    </div>
                                                    <div class="memo-detail-popup-row">
                                                        <span class="memo-detail-popup-label">Priority:</span>
                                                        <span id="memoDetailPriorityPopup" class="memo-detail-popup-value"></span>
                                                    </div>
                                                    <div class="memo-detail-popup-row">
                                                        <span class="memo-detail-popup-label">Date:</span>
                                                        <span id="memoDetailDatePopup" class="memo-detail-popup-value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="memo-body">
                                        <div id="memoBodyContent"></div>
                                    </div>
                                    <div id="attachments" class="memo-attachments"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
			</div>
		</main>
	</div>

    <script>
        window.currentUser = {
            id: '<%= user._id %>',
            email: '<%= user.email %>',
            role: '<%= user.role %>',
            department: '<%= user.department || "" %>'
        };
        window.receivedMemos = <%- JSON.stringify(received || []) %>;
    </script>
    <script src="/js/log.js"></script>
    <script src="/js/log-viewer.js"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>

